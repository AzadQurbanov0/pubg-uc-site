<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8">
  <title>NICE UC - Balans və Sifariş</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at center, #001133, #000010);
      color: white;
      overflow-x: hidden;
    }
    #loadingScreen {
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 40px;
      background: #000010;
      color: #00ccff;
    }
    header {
      background: #001f4d;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
    }
    .menu-icon {
      font-size: 28px;
      cursor: pointer;
    }
    .title {
      font-size: 22px;
      font-weight: bold;
    }
    .balance-info {
      text-align: right;
    }
    .balance-button {
      background: linear-gradient(90deg, #00ccff, #0077ff);
      padding: 6px 14px;
      border-radius: 10px;
      margin-bottom: 5px;
      box-shadow: 0 0 10px #00ccff;
    }
    .menu {
      position: fixed;
      top: 0;
      left: -100%;
      width: 250px;
      max-width: 80%;
      height: 100%;
      background: #002244;
      padding: 20px;
      transition: all 0.4s ease;
      z-index: 1000;
      box-shadow: 2px 0 5px rgba(0,0,0,0.5);
    }
    .menu.active {
      left: 0;
    }
    .menu button {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      background: #00ccff;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    .container {
      padding: 20px;
      text-align: center;
    }
    .uc-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 15px;
      margin-top: 30px;
    }
    .uc-item {
      background: #001f4d;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 0 10px #00ccff;
      cursor: pointer;
      transition: 0.3s;
    }
    .uc-item:hover {
      background: #003366;
      transform: scale(1.05);
    }
    #orderForm, #addBalanceForm {
      margin-top: 20px;
      display: none;
    }
    input, select {
      padding: 8px;
      margin-top: 10px;
      width: 80%;
      border-radius: 6px;
      border: none;
    }
    button.order-btn {
      margin-top: 15px;
      padding: 10px 20px;
      background: #00ccff;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>

<body onclick="closeMenuOutside(event)">

<div id="loadingScreen">NICE UC</div>

<div id="mainApp" style="display:none;">
  <header>
    <div class="menu-icon" onclick="toggleMenu(); event.stopPropagation();">☰</div>
    <div class="title">NICE UC</div>
    <div class="balance-info">
      <div id="userBalance" class="balance-button">0.00 AZN</div>
      <div id="orderStatus">Sifariş: 0</div>
    </div>
  </header>

  <div class="menu" id="sideMenu" onclick="event.stopPropagation()">
    <button onclick="showUC()">UC Paketləri</button>
    <button onclick="showAddBalanceForm()">Balans Artır</button>
    <button onclick="showMyOrders()">Sifarişlərim</button>
    <button onclick="logout()">Çıxış</button>
  </div>

  <div class="container" id="contentArea">
    <div class="uc-list" id="ucList"></div>

    <div id="orderForm">
      <h2 id="selectedUC"></h2>
      <input type="text" id="pubgId" placeholder="PUBG ID yaz"><br>
      <button class="order-btn" onclick="sendOrder()">Sifariş et</button><br><br>
      <button class="order-btn" onclick="showUC()">Geri Qayıt</button>
    </div>

    <div id="addBalanceForm">
      <h2>Balans Artır</h2>
      <p><b>Kart nömrəsi:</b> 4098 5844 6528 0079</p>
      <input type="number" id="paymentAmount" placeholder="Məbləğ (AZN)"><br>
      <input type="file" id="paymentScreenshot"><br>
      <button class="order-btn" onclick="sendPayment()">Göndər</button><br><br>
      <button class="order-btn" onclick="closeAddBalanceForm()">Bağla</button>
    </div>
  </div>
</div>

<script>
// Firebase Konfiqurasiyası
const firebaseConfig = {
  apiKey: "AIzaSyCnhvUqahE3tRafDNRnbM7KpfoOyCtYPoo",
  authDomain: "niceuc-28b6d.firebaseapp.com",
  databaseURL: "https://niceuc-28b6d-default-rtdb.firebaseio.com",
  projectId: "niceuc-28b6d",
  storageBucket: "niceuc-28b6d.appspot.com",
  messagingSenderId: "968041426898",
  appId: "1:968041426898:web:a5430935f2aeea76b7a20b"
};
firebase.initializeApp(firebaseConfig);

// Loading
setTimeout(() => {
  document.getElementById('loadingScreen').style.display = "none";
  document.getElementById('mainApp').style.display = "block";
}, 4000);

// Menu Aç/Bağla
function toggleMenu() {
  document.getElementById('sideMenu').classList.toggle('active');
}

// Çöldə kliklə menyunu bağla
function closeMenuOutside(event) {
  const menu = document.getElementById('sideMenu');
  if (menu.classList.contains('active') && !menu.contains(event.target)) {
    menu.classList.remove('active');
  }
}

// UC Paketləri
const ucList = document.getElementById('ucList');
const ucPackages = [
  { uc: "30+2 UC", price: "0.80" },
  { uc: "60+3 UC", price: "1.60" },
  { uc: "300+40 UC", price: "7.70" },
  { uc: "600+90 UC", price: "15.40" },
  { uc: "1500+375 UC", price: "38.30" },
  { uc: "3000+1000 UC", price: "76.60" }
];

function showUC() {
  document.getElementById('ucList').style.display = 'grid';
  document.getElementById('orderForm').style.display = 'none';
  document.getElementById('addBalanceForm').style.display = 'none';
}

ucPackages.forEach(pkg => {
  const div = document.createElement('div');
  div.className = "uc-item";
  div.innerHTML = `<h3>${pkg.uc}</h3><p>${pkg.price} AZN</p>`;
  div.onclick = () => selectUC(pkg.uc, pkg.price);
  ucList.appendChild(div);
});

let selectedUC = "";
let selectedPrice = "";

function selectUC(uc, price) {
  selectedUC = uc;
  selectedPrice = price;
  document.getElementById('selectedUC').innerText = uc + " - " + price + " AZN";
  document.getElementById('orderForm').style.display = 'block';
  document.getElementById('ucList').style.display = 'none';
  document.getElementById('addBalanceForm').style.display = 'none';
}

function sendOrder() {
  const pubgId = document.getElementById('pubgId').value.trim();
  if (!pubgId) {
    alert("PUBG ID daxil edin!");
    return;
  }
  const now = new Date();
  const order = {
    name: firebase.auth().currentUser.displayName || "İstifadəçi",
    pubgId: pubgId,
    ucAmount: selectedUC,
    price: selectedPrice,
    status: "gözləyir",
    time: now.toLocaleString()
  };
  firebase.database().ref('orders').push(order, () => {
    alert("Sifariş göndərildi!");
    document.getElementById('orderForm').style.display = 'none';
    document.getElementById('pubgId').value = '';
    showUC();
  });
}

function showAddBalanceForm() {
  document.getElementById('addBalanceForm').style.display = 'block';
  document.getElementById('ucList').style.display = 'none';
  document.getElementById('orderForm').style.display = 'none';
}

function closeAddBalanceForm() {
  document.getElementById('addBalanceForm').style.display = 'none';
  showUC();
}

function sendPayment() {
  const amount = document.getElementById('paymentAmount').value.trim();
  const screenshot = document.getElementById('paymentScreenshot').files[0];

  if (!amount || !screenshot) {
    alert("Məbləğ və şəkil əlavə edin!");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(event) {
    const paymentData = {
      name: firebase.auth().currentUser.displayName || "İstifadəçi",
      amount: amount,
      screenshot: event.target.result,
      time: new Date().toLocaleString()
    };
    firebase.database().ref('payments').push(paymentData, () => {
      alert("Ödəniş göndərildi! Admin təsdiqləyəcək.");
      document.getElementById('addBalanceForm').style.display = 'none';
      document.getElementById('paymentAmount').value = '';
      document.getElementById('paymentScreenshot').value = '';
      showUC();
    });
  };
  reader.readAsDataURL(screenshot);
}

function showMyOrders() {
  alert("Sifarişlərin admin tərəfindən təsdiqlənəcək.");
}

function logout() {
  firebase.auth().signOut().then(() => {
    alert("Çıxış edildi!");
    location.reload();
  });
}

// Gmail ilə giriş popup
firebase.auth().onAuthStateChanged(user => {
  if (user) {
    firebase.database().ref('users/' + user.uid).on('value', snapshot => {
      const data = snapshot.val();
      if (data && data.balance !== undefined) {
        document.getElementById('userBalance').innerText = parseFloat(data.balance).toFixed(2) + " AZN";
      }
    });

    firebase.database().ref('orders').orderByChild('name').equalTo(user.displayName).on('value', snapshot => {
      let total = 0;
      snapshot.forEach(child => { total++; });
      document.getElementById('orderStatus').innerText = "Sifariş: " + total;
    });
  } else {
    const provider = new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithPopup(provider).then((result) => {
      console.log("Google ilə giriş edildi:", result.user.displayName);
    }).catch((error) => {
      alert("Google ilə giriş xətası: " + error.message);
    });
  }
});
</script>

</body>
</html>
